<div class="pt-0 pb-3 pr-3 pl-3" *ngIf="!mainLoading">
  <div *ngIf="checkUser()" class="{'pb-5': currentTask !== null}">
    <div class="border-heading" *ngIf="currentTask !== null">
      {{'pending checklist item' | uppercase}}
    </div>
    <div class="d-flex flex-column mb-2 pl-2" *ngIf="currentTask !== null">
      <label id="example-radio-group-label">{{currentTask.name}}</label>
      <mat-radio-group class="example-radio-group" [(ngModel)]="currentTask.generalFields">
        <mat-radio-button class="example-radio-button" value="yes">
          <span id="answer">{{'Yes'}}</span>
        </mat-radio-button>
        <mat-radio-button class="example-radio-button" value="no">
          <span id="answer">{{'No'}}</span>
        </mat-radio-button>
      </mat-radio-group>
    </div>

    <div *ngFor="let progressInfo of progressInfos" class="mb-2">
      <span>{{ progressInfo.fileName }}</span>
      <div class="progress">
        <div class="progress-bar progress-bar-info progress-bar-striped" role="progressbar"
          attr.aria-valuenow="{{ progressInfo.value }}" aria-valuemin="0" aria-valuemax="100"
          [ngStyle]="{ width: progressInfo.value + '%' }">
          {{ progressInfo.value }}%
        </div>
      </div>
    </div>

    <div *ngIf="message?.length" class="alert alert-secondary my-3" role="alert">
      <ul *ngFor="let msg of message; let i = index">
        <li>{{ msg }}</li>
      </ul>
    </div>

    <div class="d-flex flex-column" *ngIf="currentTask !== null">

      <small *ngIf="selectedFiles?.length" class="pl-2 pb-2">
        <span id="answer">{{selectedFiles.length}}</span> Files Selected
      </small>

      <input #myInput class="display-block" type="file" id="fileUpload" name="fileUpload" multiple="multiple"
        style="display: none;" />

      <button *ngIf="!apiLoading" mat-raised-button color="warn" (click)="uploadFile()">
        <mat-icon class="mr-2">add_box</mat-icon>
        {{'select supporting doc(s)' | titlecase}}
      </button>

      <button *ngIf="!apiLoading" class="mt-2 d-flex align-items-center justify-content-center" mat-raised-button
        color="primary" [disabled]="!selectedFiles" (click)="uploadFiles('quarter')">
        <mat-icon class="mr-2">file_upload</mat-icon>
        Upload Documents
      </button>

      <button *ngIf="!apiLoading" [disabled]="currentTask?.generalFields === null" class="mt-2" mat-raised-button
        color="primary" [disabled]="!selectedFiles" (click)="goToNextStage()">
        Next Stage
        <mat-icon class="mr-2">arrow_right</mat-icon>
      </button>

      <mat-progress-spinner *ngIf="apiLoading" mode="indeterminate" diameter="25"></mat-progress-spinner>

    </div>
  </div>

  <div class="mt-2">
    <div class="border-heading">{{'completed checklist items' | uppercase}}</div>
    <mat-tab-group [selectedIndex]="0">
      <mat-tab *ngFor="let tab of completedChecklist; let index = index" [label]="tab.name">
        <div class="p-2">
          <div class="general-info d-flex flex-column flex-fill justify-content-start mb-3">
            <span style="color: #0070b1;font-weight:600;" id="title">{{tab.name}}</span>
            <span id="value">{{tab.generalFields | uppercase}}</span>
          </div>

          <span class="pl-2" id="answer">{{tab.files?.length || 0}}</span> File(s) Uploaded

          <div *ngIf="tab.files?.length" class="mt-3">
            <div class="mb-2 table-row d-flex flex-fill align-items-center justify-content-between"
              *ngFor="let file of tab.files; let i = index;">
              <div class="d-flex flex-column">
                <span class="small-text mb-2">{{file.name}}</span>
                <div class="d-flex align-items-center">
                  <div class="small-text">Uploaded By:&nbsp;</div>
                  <div class="small-text" id="comment-b">{{file.created_by}}</div>
                </div>
              </div>

              <a class="view-btn-attach" [download]="file.name" [href]="'data:image/jpeg;base64,' + file.picByte"
                target="_blank">
                <mat-icon class="download-btn">download</mat-icon>
              </a>
            </div>
          </div>
        </div>

      </mat-tab>
    </mat-tab-group>
  </div>

</div>
<div *ngIf="mainLoading" class="d-flex">
  <mat-progress-spinner mode="indeterminate" diameter="25"></mat-progress-spinner>
</div>