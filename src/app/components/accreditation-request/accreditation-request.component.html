<mat-toolbar *ngIf="toggle && !commentsFlag && !mitigationsFlag && !viewReport"
  style="margin-top:0px;padding: 10px 0px;" color="primary">
  <mat-toolbar-row>
    <span *ngIf="currentUser?.role === 'process owner'">{{selectedRequest?.initiatorFullName ?
      selectedRequest?.initiatorFullName : selectedRequest?.initiatedBy.name}}</span>
    <span *ngIf="currentUser?.role === 'sme'">{{selectedRequest?.initiatedBy.name}}</span>
    <span class="example-spacer"></span>
    <span *ngIf="currentUser?.role === 'process owner'">{{selectedRequest?.submittedAt | date:'fullDate'}}</span>
    <span class="example-spacer"></span>

    <!-- <button mat-icon-button>
      <mat-icon class="example-icon" *ngIf="allReviewsFlag">view_quilt
      </mat-icon>
    </button> -->
    <button (click)="goBack()" mat-icon-button>
      <mat-icon class="example-icon" aria-hidden="false" aria-label="Close">close
      </mat-icon>
    </button>
  </mat-toolbar-row>
</mat-toolbar>

<div class="m-20" *ngIf="apiLoading">
  <mat-card>
    <mat-card-content>
      <mat-progress-spinner mode="indeterminate" diameter="40"></mat-progress-spinner>
    </mat-card-content>
  </mat-card>
</div>

<div [ngClass]="{'mobile-class': addMobileClasses}" class="view-block" *ngIf="toggle && !commentsFlag && !apiLoading
 && !mitigationsFlag  && !viewReport">
  <div class="margin-5 form-items">

    <div *ngFor="let item of userReviewRequests">

      <mat-toolbar class="no-margin" color="primary" [hidden]="hideForms && item.assigned === false">
        <mat-toolbar-row>
          <div class="title-details">
            <span id="title">{{item.name}}</span>
            <div class="review-info">
              <span id="date" class="request-status" *ngIf="item.review.rating !== null">Reviewed:
                {{item.endDate | date:'shortDate'}}</span>
              <span id="date" class="request-status" *ngIf="item.review.rating === null">Pending:
                {{item.endDate | date:'shortDate'}}</span>
              <span id="stars" *ngIf="item.review.rating !== null">
                <bar-rating [theme]="'fontawesome-o'" [(rate)]="item?.review.rating" [max]="max"></bar-rating>
              </span>
            </div>
          </div>
          <span class="example-spacer"></span>
          <mat-icon *ngIf="item.reviewStatus === 'Expired'" color="warn" matTooltip="Task Expired!">
            notification_important</mat-icon>
          <div *ngIf="currentUser?.role !== 'sme'" class="m-2">
            <button matTooltip="Assign Task" (click)="openDialog(item)"
              *ngIf="item.review.rating === null && (item.reviewStatus === null || item.reviewStatus === 'Pending')"
              [disabled]="item.review.rating === null && item.reviewStatus === 'Pending'" mat-button color="basic">
              <mat-icon>assignment</mat-icon>Assign-Task
            </button>
            <!-- <button matTooltip="Re-evaluate Task" [disabled]="item.review.rating !== null" -->
            <button matTooltip="Re-evaluate Task"
              [disabled]="item.review.rating !== null && item.reviewStatus === 'Pending'" (click)="openDialog(item)"
              *ngIf="item.review.rating !== null && (item.reviewStatus === null || item.reviewStatus === 'Pending'|| item.reviewStatus === 'Completed')"
              mat-button color="basic">
              <mat-icon>redo</mat-icon> Re-Evaluate
            </button>
          </div>
          <div class="profile-details">
            <span>{{(convertNumber(item.totalScore) / totalFormScore) * 100 | number:'1.0-0'}}%</span>
            <div *ngIf="currentUser?.role !== 'sme'">
              <small id="request-status" *ngIf="item.previousReview === null && item.currentReview === null">Not
                Reviewed</small>
              <small id="request-status" *ngIf="item.review.rating !== null">REVIEWED</small>
              <small id="request-status" *ngIf="item.review.rating === null">PENDING</small>
            </div>
          </div>
        </mat-toolbar-row>
      </mat-toolbar>

      <mat-card class="example-result-card mb-3" [hidden]="hideForms && item.assigned === false">
        <mat-card-content>
          <div class="section-info">
            <span class="mb-3" style="display: block;font-weight: bold;">
              SME:
              <span id="comment">{{item.sme.name}}</span>
            </span>
            <span class="mb-3" style="display: block;font-weight: bold;" *ngIf="item.review.rating !== null">
              SCORED WEITAGE:
              <span id="comment">{{(item.review.rating/2) | number:'1.0-4'}}</span>
            </span>
            <button *ngIf="item.assigned && selectedSection === item.id || currentUser?.role !== 'sme'"
              mat-raised-button color="primary" (click)="toggleEntryForm(item)">
              {{item.toggleForm ? 'Show Reviews' : 'Show Form'}}
            </button>
          </div>

          <formio *ngIf="currentUser?.role !== 'sme' && item.review.rating === null" [form]="item.template"
            readOnly="true" [submission]="{data: item.data}"></formio>
          <formio *ngIf="currentUser?.role !== 'sme' && item.review.rating !== null && item.toggleForm"
            [form]="item.template" readOnly="true" [submission]="{data: item.data}"></formio>
          <formio *ngIf="!item.assigned && currentUser?.role === 'sme'" [form]="item.template" readOnly="true"
            [submission]="{data: item.data}"></formio>
          <formio *ngIf="item.assigned && currentUser?.role === 'sme' && selectedSection !== item.id"
            [form]="item.template" readOnly="true" [submission]="{data: item.data}"></formio>
          <formio *ngIf="item.formReviewObjects && item.toggleForm" [form]="item.template" readOnly="true"
            [submission]="{data: item.data}"></formio>

          <!-- SME ACTION BLOCK -->
          <div *ngIf="currentUser?.role === 'sme' && item.assigned === true && !item.toggleForm"
            [hidden]="item.assigned && selectedSection !== item.id">
            <span *ngIf="item.assigned && selectedSection === item.id" id="myTopElement2" #myTopElement2></span>
            <div class="form-comments" *ngFor="let obj of item.formReviewObjects">
              <div class="details">
                <span>{{obj.title}}</span>
                <span *ngIf="item.value === true">{{"true"}}</span>
                <span *ngIf="obj.type !== 'file'" id="answer">{{obj.value}}</span>
                <span *ngIf="obj.type === 'file'" id="answer">
                  <span *ngIf="obj?.value?.length">Uploaded</span>
                  <span *ngIf="!obj?.value?.length">Not Uploaded</span>
                </span>
                <span>
                  <mat-form-field>
                    <mat-label>Comments</mat-label>
                    <input [disabled]="reviewAdded" matInput placeholder="Write any comments" [(ngModel)]="obj.comments"
                      value="obj.comments" />
                  </mat-form-field>
                </span>
              </div>
              <div class="controls">
                <bar-rating [theme]="'fontawesome-o'" [(rate)]="obj.rating" [max]="max"></bar-rating>
                <mat-button-toggle-group [disabled]="reviewAdded" [(ngModel)]="obj.status"
                  #group="matButtonToggleGroup">
                  <mat-button-toggle color="primary" (change)="onValChange($event)" value="satisfy"
                    aria-label="Text align left">
                    <mat-icon style="color:green;">thumb_up</mat-icon>
                  </mat-button-toggle>
                  <mat-button-toggle (change)="onValChange($event)" value="un-satisfy" aria-label="Text align center">
                    <mat-icon color="warn">thumb_down</mat-icon>
                  </mat-button-toggle>
                </mat-button-toggle-group>
              </div>
            </div>
            <div class="comment-box">
              <mat-form-field appearance="outline">
                <mat-label>Mitigation Factors</mat-label>
                <textarea [(ngModel)]="item.review.comments" matInput></textarea>
              </mat-form-field>
              <div style="padding: 15px;">
                <mat-spinner *ngIf="submitLoading" diameter="40"></mat-spinner>
                <button *ngIf="!submitLoading"
                  [disabled]="reviewAdded || (item.review.rating !== null && (item.reviewStatus === 'Completed' || item.reviewStatus === 'Expired'))"
                  (click)="addRequestReview(item)" mat-mini-fab color="accent">
                  <mat-icon>send</mat-icon>
                </button>
              </div>
            </div>
          </div>

          <!-- OTHERS ACTION BLOCK -->
          <div *ngIf="currentUser?.role !== 'sme' && item.review.rating !== null && !item.toggleForm">
            <div class="form-comments" *ngFor="let obj of item.review.controlWiseComments">
              <div class="details">
                <span>{{obj.title}}</span>
                <span *ngIf="obj.value === true">{{"true"}}</span>
                <span *ngIf="obj.type !== 'file'" id="answer">{{obj.value}}</span>
                <span *ngIf="obj.type === 'file'" id="answer">
                  <span *ngIf="obj?.value?.length">Uploaded</span>
                  <span *ngIf="!obj?.value?.length">Not Uploaded</span>
                </span>
                <span>
                  <mat-form-field>
                    <mat-label>Comments</mat-label>
                    <input disabled matInput placeholder="Write any comments" [(ngModel)]="obj.comments"
                      value="obj.comments" />
                  </mat-form-field>
                </span>
              </div>
              <div class="controls admin-controls">
                <bar-rating [theme]="'fontawesome-o'" [(rate)]="obj.rating" [max]="max"></bar-rating>
                <mat-button-toggle-group disabled [(ngModel)]="obj.status" #group="matButtonToggleGroup">
                  <mat-button-toggle *ngIf="obj.status === 'satisfy'" color="primary" (change)="onValChange($event)"
                    value="satisfy" aria-label="Text align left">
                    <mat-icon style="color:green;">thumb_up</mat-icon>
                  </mat-button-toggle>
                  <mat-button-toggle *ngIf="obj.status === 'un-satisfy'" (change)="onValChange($event)"
                    value="un-satisfy" aria-label="Text align center">
                    <mat-icon color="warn">thumb_down</mat-icon>
                  </mat-button-toggle>
                </mat-button-toggle-group>
              </div>
            </div>
            <div class="comment-box">
              <mat-form-field appearance="outline">
                <mat-label>Comments</mat-label>
                <textarea disabled [(ngModel)]="item.review.comments" matInput></textarea>
              </mat-form-field>
            </div>
          </div>

        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <!-- RIGHT HAND LAYOUT -->
  <div class="margin-5 activity-items control-box">
    <div [ngClass]="{'for-sme': currentUser?.role === 'sme'}" class="right-layout">
      <mat-card *ngIf="currentUser?.role !== 'sme'">
        <mat-card-content>
          <mat-list>
            <mat-list-item>
              <mat-icon mat-list-icon>assignment_turned_in</mat-icon>
              <div mat-line>{{'Assigned Tasks'}}</div>
              <div mat-line>{{sectionStats?.pendingCount}}</div>
            </mat-list-item>
            <mat-list-item>
              <mat-icon mat-list-icon>assignment_late</mat-icon>
              <div mat-line>{{'Unassigned Tasks'}}</div>
              <div mat-line>{{sectionStats?.unassignCount}}</div>
            </mat-list-item>
            <mat-list-item>
              <mat-icon mat-list-icon>assignment_returned</mat-icon>
              <div mat-line>{{'Reviews Submitted'}}</div>
              <div mat-line>{{sectionStats?.reviewsCount}}</div>
            </mat-list-item>
            <mat-list-item>
              <mat-icon mat-list-icon>folder</mat-icon>
              <div mat-line>{{'Total Sections'}}</div>
              <div mat-line>{{userReviewRequests.length}}</div>
            </mat-list-item>
            <mat-list-item>
              <mat-icon mat-list-icon>folder</mat-icon>
              <div mat-line>{{'Pending FIP Tasks'}}</div>
              <div mat-line>{{reAssignedTasks.length}}</div>
            </mat-list-item>
            <mat-list-item>
              <mat-icon mat-list-icon>alarm_on</mat-icon>
              <div mat-line>{{'Expiry Date'}}</div>
              <div mat-line>{{selectedRequest?.expiryDate | date:'fullDate'}}</div>
            </mat-list-item>
          </mat-list>
        </mat-card-content>
      </mat-card>
      <mat-card *ngIf="currentUser?.role === 'sme'">
        <mat-card-content>
          <mat-list>
            <mat-list-item>
              <mat-icon mat-list-icon>assignment_turned_in</mat-icon>
              <div mat-line>{{'Total Sections'}}</div>
              <div mat-line>{{userReviewRequests?.length}}</div>
            </mat-list-item>
            <mat-list-item>
              <mat-icon mat-list-icon>assignment_turned_in</mat-icon>
              <div mat-line>{{'Assigned Sections'}}</div>
              <div mat-line>{{sectionStats?.mySectionsCount}}</div>
            </mat-list-item>
            <mat-list-item>
              <mat-icon mat-list-icon>assignment_returned</mat-icon>
              <div mat-line>{{'Selected Task'}}</div>
              <div mat-line>{{selectedSectionData?.name}}</div>
              <div style="cursor: pointer;" mat-line id="answer" (click)="goToReviews()">view task</div>
            </mat-list-item>

          </mat-list>
        </mat-card-content>
      </mat-card>
      <mat-card>
        <mat-card-content>
          <div *ngIf="currentUser?.role !== 'sme'">
            <div class="top-controls">
              <div class="fullbtn">
                <button [disabled]="allTasksAssingedFlag" color="accent" (click)="openDialog('all-tasks')"
                  class="control-btn" mat-flat-button>ASSIGN ALL
                  TASKS</button>
              </div>
              <!-- <div class="fullbtn">
                <button color="primary" (click)="viewEligibility()" class="control-btn" mat-flat-button>VIEW
                  ELIGIBILITY</button>
              </div> -->
              <div class="fullbtn">
                <button color="warn" (click)="exportReport()" class="control-btn" mat-flat-button>EXPORT
                  REPORT</button>
              </div>
              <div class="fullbtn">
                <button color="primary" (click)="viewCommentsMatrix(userReviewRequests)" class="control-btn"
                  mat-flat-button>COMMENTS MATRIX</button>
              </div>
              <div class="fullbtn">
                <button (click)="showMitigationPlan(userReviewRequests)"
                  *ngIf="allReviewsFlag && currentUser?.role !== 'sme'" color="warn" mat-raised-button>VIEW MITIGATION
                  PLAN</button>
              </div>
              <!-- <div class="fullbtn">
                <button [disabled]="selectedRequest?.subStatus === 'Pending' && 
                selectedRequest?.markedTo === 'Marked To GM' || 
                selectedRequest?.markedTo === 'Marked To CEO'" (click)="markToGm()"
                  *ngIf="allReviewsFlag && currentUser?.role !== 'sme'" color="warn" mat-raised-button>MARK TO
                  GM</button>
                <mat-progress-spinner [diameter]="15"></mat-progress-spinner>
              </div> -->
              <div class="fullbtn">
                <button (click)="setRequestStatus()" *ngIf="allReviewsFlag && currentUser?.role !== 'sme'" color="warn"
                  mat-button>SET
                  STATUS</button>
              </div>
              <div class="comments-box">
                <mat-form-field appearance="outline">
                  <mat-label>Comments for fip</mat-label>
                  <textarea matInput [(ngModel)]="commentsForFip" placeholder="write your comments..."></textarea>
                </mat-form-field>
                <button (click)="intimateFip()"
                  [disabled]="!commentsForFip || (sectionStats?.unassignCount !== userReviewRequests.length)"
                  color="accent" mat-raised-button>INTIMATE
                  FIP</button>
              </div>
            </div>
          </div>
          <div *ngIf="currentUser?.role === 'sme'">
            <div class="top-controls">
              <div class="fullbtn">
                <button (click)="hideForms = !hideForms" [color]="!hideForms ? 'primary' : 'warn'" class="control-btn"
                  mat-flat-button>
                  <mat-icon style="font-size: 20px;">filter_alt</mat-icon>
                  {{!hideForms ? 'FILTER MY SECTIONS' : 'SHOW ALL SECTIONS'}}
                </button>
              </div>
            </div>
          </div>
        </mat-card-content>
        <mat-card-actions>
          <div class="bottom-controls" *ngIf="currentUser?.role !== 'sme'">
            <div class="left-block">
              <span class="head">Accredit Status:</span>
              <span id="comment" class="answer mb-3">{{selectedRequest?.status | uppercase}}</span>
              <span class="head" *ngIf="allReviewsFlag && currentUser?.role !== 'sme'">System Status:</span>
              <span id="warn" class="answer" *ngIf="allReviewsFlag && currentUser?.role !== 'sme'">{{userSystemStatus |
                uppercase}}</span>
            </div>
            <div class="right-block">
              <span class="head">Current Score</span>
              <span class="comments">{{(userAllScore/2) || 0 | number:'1.0-4'}}</span>
              <!-- <span *ngIf="userAllScore" id="answer" class="comments">{{(userAllScore/5 * 100)}}%</span> -->
            </div>
          </div>
        </mat-card-actions>
      </mat-card>
    </div>
  </div>
</div>

<!-- COMMENTS FROM FIP -->
<div *ngIf="commentsFlag && !apiLoading && !mitigationsFlag && !viewReport">
  <mat-toolbar style="margin-bottom: 25px;" color="primary">
    <mat-toolbar-row>
      <span>{{"Comments Matrix"}}</span>
      <span class="example-spacer"></span>
      <span>{{selectedRequest?.initiatedBy.name}}</span>
      <span class="example-spacer"></span>
      <button (click)="hideComments()" mat-icon-button>
        <mat-icon class="example-icon" aria-hidden="false" aria-label="Close">close
        </mat-icon>
      </button>
    </mat-toolbar-row>
  </mat-toolbar>
  <mat-toolbar color="primary">
    <mat-toolbar-row>
      <small>{{"Sections"}}</small>
      <span class="example-spacer"></span>
      <small> Comments</small>
      <span class="example-spacer"></span>
      <small>Mitigations</small>
    </mat-toolbar-row>
  </mat-toolbar>
  <mat-card style="padding: 0px;margin: 20px;">
    <div *ngIf="!commentsHistoryFlag">
      <div class="comments-matrix" *ngFor="let item of commentsData">
        <div class="title-details">
          <span id="title">{{item.name}}</span>
          <div class="review-info">
            <span id="stars" *ngIf="item.review.rating !== null">
              <bar-rating [theme]="'fontawesome-o'" [(rate)]="item.review.rating" [max]="max"></bar-rating>
            </span>
            <div class="m-2" *ngIf="item.reviewHistory !== null">
              <button color="accent" mat-button (click)="showCommentsHistoty(item)">View History</button>
            </div>
          </div>
        </div>
        <div class="form-comments">
          <div class="form-item mat-elevation-z2" *ngFor="let obj of item.review?.controlWiseComments">
            <div class="form-item-boxes">
              <div class="details">
                <span>{{obj.title}}</span>
                <span *ngIf="obj.value === true">{{"true"}}</span>
                <span *ngIf="obj.type !== 'file'" id="answer">{{obj.value}}</span>
                <span *ngIf="obj.type === 'file'" id="answer">
                  <span *ngIf="obj?.value?.length">Uploaded</span>
                  <span *ngIf="!obj?.value?.length">Not Uploaded</span>
                </span>
                <div class="field-comments">
                  <span id="comment">{{obj.comments}}</span>
                </div>
              </div>
              <div class="controls admin-controls">
                <bar-rating [theme]="'fontawesome-o'" [(rate)]="obj.rating" [max]="max"></bar-rating>
                <mat-icon style="font-size: 20px;color: green;margin-top: 8px;" *ngIf="obj.status === 'satisfy'">
                  thumb_up
                </mat-icon>
                <mat-icon style="font-size: 20px;color: red;margin-top: 8px;" *ngIf="obj.status === 'un-satisfy'">
                  thumb_down</mat-icon>
              </div>
            </div>
          </div>
        </div>
        <div class="review-comments">
          <span>{{item.review?.comments}}</span>
        </div>
        <mat-divider></mat-divider>
      </div>
    </div>
    <div *ngIf="commentsHistoryFlag">
      <div class="m-2">
        <button mat-button color="warn" (click)="commentsHistoryFlag = !commentsHistoryFlag">Close History</button>
      </div>
      <div class="comments-matrix" *ngFor="let item of commentsHistory">
        <div class="title-details">
          <span id="title">{{selectedHistoryItem.name}}</span>
          <div class="review-info">
            <span id="stars" *ngIf="item.rating !== null">
              <bar-rating [(rate)]="item.rating" [max]="max"></bar-rating>
            </span>
          </div>
        </div>
        <div class="form-comments">
          <div class="form-item mat-elevation-z2" *ngFor="let obj of item.controlWiseComments">
            <div class="form-item-boxes">
              <div class="details">
                <span>{{obj.title}}</span>
                <span *ngIf="obj.value === true">{{"true"}}</span>
                <span *ngIf="obj.type !== 'file'" id="answer">{{obj.value}}</span>
                <span *ngIf="obj.type === 'file'" id="answer">
                  <span *ngIf="obj?.value?.length">Uploaded</span>
                  <span *ngIf="!obj?.value?.length">Not Uploaded</span>
                </span>
                <div class="field-comments">
                  <span id="comment">{{obj.comments}}</span>
                </div>
              </div>
              <div class="controls admin-controls">
                <bar-rating [theme]="'fontawesome-o'" [(rate)]="obj.rating" [max]="max"></bar-rating>
                <mat-icon style="font-size: 20px;color: green;margin-top: 8px;" *ngIf="obj.status === 'satisfy'">
                  thumb_up
                </mat-icon>
                <mat-icon style="font-size: 20px;color: red;margin-top: 8px;" *ngIf="obj.status === 'un-satisfy'">
                  thumb_down</mat-icon>
              </div>
            </div>
          </div>
        </div>
        <div class="review-comments">
          <span>{{item.comments}}</span>
        </div>
        <mat-divider></mat-divider>
      </div>
    </div>
  </mat-card>
</div>

<div *ngIf="mitigationsFlag && !apiLoading && !viewReport">
  <mat-toolbar style="margin-bottom: 25px;" color="primary">
    <mat-toolbar-row>
      <span>{{"Risk Mitigations"}}</span>
      <span class="example-spacer"></span>
      <span>{{selectedRequest?.initiatedBy.name}}</span>
      <span class="example-spacer"></span>
      <button (click)="hideMitigationsFlag()" mat-icon-button>
        <mat-icon class="example-icon" aria-hidden="false" aria-label="Close">close
        </mat-icon>
      </button>
    </mat-toolbar-row>
  </mat-toolbar>
  <mat-toolbar color="primary">
    <mat-toolbar-row>
      <small>{{"Sections"}}</small>
      <span class="example-spacer"></span>
      <small> Comments</small>
      <span class="example-spacer"></span>
      <small>Mitigations</small>
    </mat-toolbar-row>
  </mat-toolbar>
  <mat-card style="padding: 0px;margin: 20px;">
    <div *ngFor="let item of userReviewRequests">
      <div *ngIf="item.review?.mitigationArray.length">
        <div class="comments-matrix">
          <div class="title-details">
            <span id="title">{{item.name}}</span>
            <div class="review-info">
              <span id="stars" *ngIf="item.review.rating !== null">
                <bar-rating [theme]="'fontawesome-o'" [(rate)]="item.review.rating" [max]="max"></bar-rating>
              </span>
              <!-- <div class="m-2" *ngIf="item.reviewHistory !== null">
              <button color="accent" mat-button (click)="showCommentsHistoty(item)">View History</button>
            </div> -->
            </div>
          </div>
          <div class="form-comments">
            <div class="form-item mat-elevation-z2" *ngFor="let obj of item.review?.mitigationArray">
              <div class="form-item-boxes">
                <div class="details">
                  <span>{{obj.title}}</span>
                  <span *ngIf="obj.value === true">{{"true"}}</span>
                  <span *ngIf="obj.type !== 'file'" id="answer">{{obj.value}}</span>
                  <span *ngIf="obj.type === 'file'" id="answer">
                    <span *ngIf="obj?.value?.length">Uploaded</span>
                    <span *ngIf="!obj?.value?.length">Not Uploaded</span>
                  </span>
                  <div class="field-comments">
                    <span id="comment">{{obj.comments}}</span>
                  </div>
                </div>
                <div class="controls admin-controls">
                  <bar-rating [theme]="'fontawesome-o'" [(rate)]="obj.rating" [max]="max"></bar-rating>
                  <mat-icon style="font-size: 20px;color: green;margin-top: 8px;" *ngIf="obj.status === 'satisfy'">
                    thumb_up
                  </mat-icon>
                  <mat-icon style="font-size: 20px;color: red;margin-top: 8px;" *ngIf="obj.status === 'un-satisfy'">
                    thumb_down</mat-icon>
                </div>
              </div>
            </div>
          </div>
          <div class="review-comments">
            <span>{{item.review?.comments}}</span>
          </div>
          <mat-divider></mat-divider>
        </div>
      </div>
    </div>
  </mat-card>
</div>

<div *ngIf="viewReport">
  <mat-toolbar style="margin-bottom: 25px;" color="primary">
    <mat-toolbar-row>
      <span>{{"Detailed Accreditation Evaluation"}}</span>
      <span class="example-spacer"></span>
      <span>{{selectedRequest?.initiatedBy.name}}</span>
      <span class="example-spacer"></span>
      <button (click)="hideExportReport()" mat-icon-button>
        <mat-icon class="example-icon" aria-hidden="false" aria-label="Close">close
        </mat-icon>
      </button>
    </mat-toolbar-row>
  </mat-toolbar>
  <mat-card style="padding: 15px;margin: 20px;">
    <mat-card-content>

      <div class="row" style="padding: 0px;margin: 0px 0px;">
        <div class="col-md-4 overall">
          <span class="head">{{'Name of the entity'}}</span>
        </div>
        <div class="col-md-8 overall">
          <span class="value">{{selectedRequest?.initiatedBy.name}}</span>
        </div>
      </div>

      <div class="row" style="padding: 0px;margin: 0px 0px;">
        <div class="col-md-4 overall">
          <span class="head">{{'Submitted at'}}</span>
        </div>
        <div class="col-md-8 overall">
          <span class="value">{{selectedRequest?.submittedAt | date:'shortDate'}}</span>
        </div>
      </div>

      <div class="row" style="padding: 0px;margin: 0px 0px;">
        <div class="col-md-6" style="padding: 0px;">
          <div class="overall">
            <span class="head">{{'Applicant"s Eligibility'}}</span>
          </div>
          <div class="overall">
            <span class="value">{{selectedRequest?.eligibility.status}}</span>
          </div>
        </div>
        <div class="col-md-6" style="padding: 0px;">
          <div class="overall">
            <span class="head">{{'Eligibility submitted at'}}</span>
          </div>
          <div class="overall">
            <span class="value">{{selectedRequest?.eligibility.submittedAt | date:'shortDate'}}</span>
          </div>
        </div>
      </div>

      <div class="team" style="padding: 15px;margin: 0px 0px;">
        <div class="header row">
          <div class="col-md-6 item">Areas</div>
          <div class="col-md-6 item">Names</div>
        </div>
        <div *ngFor="let item of userReviewRequests">
          <div class="box row">
            <div class="col-md-6 name">{{item.name}}</div>
            <div class="col-md-6 sme">{{item.sme.name}}</div>
          </div>
        </div>
      </div>

      <div class="row accred" style="padding: 0px;margin: 0px 0px;">
        <div class="col-md-12 title">{{'Component wise score'}}</div>
      </div>
      <div class="scores row" style="padding: 0px;margin: 0px 0px;">
        <div class="col-md-4 d-flex flex-column box" *ngFor="let item of userReviewRequests">
          <span class="name">{{item.name}}</span>
          <span class="sme">{{item.review.rating}}</span>
        </div>
      </div>
      <div class="row" style="padding: 0px;margin: 0px 0px;">
        <div class="col-md-4 overall">
          <span class="head">{{'Overall Score'}}</span>
        </div>
        <div class="col-md-8 overall">
          <span class="value">{{userAllScore}}</span>
        </div>
      </div>
      <div class="row" style="padding: 0px;margin: 0px 0px;">
        <div class="col-md-4 overall">
          <span class="head">{{'System Status'}}</span>
        </div>
        <div class="col-md-8 overall">
          <span class="value">{{userSystemStatus}}</span>
        </div>
      </div>
      <div class="row" style="padding: 0px;margin: 0px 0px;">
        <div class="col-md-4 overall">
          <span class="head">{{'Current Status'}}</span>
        </div>

        <div class="col-md-8 overall">
          <span class="value">{{selectedRequest?.status}}</span>
        </div>
      </div>

      <div class="row accred" style="padding: 0px;margin: 0px 0px;">
        <div class="col-md-12 title">
          {{'Area wise factors requiring risk mitigation (if any)'}}
        </div>
      </div>

      <div class="row d-flex flex-align-center miti" *ngFor="let item of userReviewRequests"
        style="padding: 0px;margin: 0px 0px 10px;">
        <div class="col-md-4" style="background-color: #E7E6E6;padding: 5px;">
          <span>{{item.name}}</span>
        </div>
        <div class="col-md-8">
          <div class="controls-wise" *ngFor="let obj of item.review.controlWiseComments">
            <span *ngIf="obj.status === 'un-satisfy'">-{{obj.comments}}</span>
          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>