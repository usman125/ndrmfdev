<ng-container *ngIf="show === 'pip'">


  <mat-toolbar *ngIf="loggedUser.role === 'admin' || loggedUser.role === 'fip'" color="primary" class="header no-margin"
    style="padding: 15px 0px;">
    <mat-toolbar-row>
      <span>
        Add Main Costings {{proMonths}}
      </span>
    </mat-toolbar-row>
  </mat-toolbar>

  <mat-card *ngIf="loggedUser.role === 'admin' || loggedUser.role === 'fip'"
    style="margin: 25px;margin-top: 20px !important;">
    <mat-card-content>


      <!-- <mat-grid-list cols="1" rowHeight="130px">
      <mat-grid-tile>
        <div style="display: flex; flex-direction: column;width:100%;padding: 10px;">
          <mat-form-field>
            <mat-label for="financer">Financer Title</mat-label>
            <input placeholder="e.g. NDRMF" [(ngModel)]="financer" id="financer" type="text" matInput />
          </mat-form-field>
          <button color="primary" (click)="AddFinancer()" mat-raised-button>
            Add Financer
          </button>
        </div>
      </mat-grid-tile>
    </mat-grid-list> -->

      <mat-grid-list cols="1" rowHeight="170px" *ngIf="loggedUser.role === 'admin'">
        <mat-grid-tile>
          <div style="display:flex;flex-direction:column;width:100%;padding: 10px;">
            <mat-form-field>
              <mat-label for="cost">Cost Title</mat-label>
              <input placeholder="e.g. HR" [(ngModel)]="cost" id="cost" type="text" matInput />
            </mat-form-field>
            <mat-form-field>
              <mat-label for="cost">GL Code</mat-label>
              <input placeholder="e.g. 123-HR" [(ngModel)]="glCode" id="glCode" type="text" matInput />
            </mat-form-field>
            <button [disabled]="cost === null || glCode === null" color="primary" (click)=" AddCost()"
              mat-raised-button>
              Add Cost
            </button>
          </div>
        </mat-grid-tile>
      </mat-grid-list>


      <mat-grid-list cols="1" rowHeight="170px" *ngIf="loggedUser.role === 'fip'">
        <mat-grid-tile>
          <div style="display: flex; flex-direction: column;width:100%;padding: 10px;">
            <mat-form-field>
              <mat-label for="subcost">Subcost Title</mat-label>
              <input placeholder="e.g. School" [(ngModel)]="subcost" id="subcost" type="text" matInput />
            </mat-form-field>
            <mat-form-field>
              <mat-label>Select Main Cost</mat-label>
              <mat-select (ngModelChange)="mainCostChanged($event)" [(ngModel)]="mainCostId">
                <mat-option *ngFor="let item of allCosts" [value]="item._id">
                  {{item.title}}</mat-option>
              </mat-select>
            </mat-form-field>
            <button [disabled]="subcost === null || mainCostId === null" color="primary" (click)="AddSubcost()"
              mat-raised-button>
              Add Subcost
            </button>
          </div>
        </mat-grid-tile>


      </mat-grid-list>

    </mat-card-content>
  </mat-card>

  <mat-card style="padding:0px;">
    <!-- <mat-card-title>
    <div class="header">
      <span>
        Name
      </span>
      <div class="example-spacer"></div>
      <span>
        Procurement: <span id="comment">{{procurementCost}}</span>
      </span>
      <div class="example-spacer"></div>
      <span>
        Total: <span id="comment">{{totalCostSummary}}</span>
      </span>
    </div>
  </mat-card-title>
  <mat-divider></mat-divider> -->
    <mat-card-content>
      <mat-toolbar color="primary" class="header no-margin">
        <mat-toolbar-row>
          <span>
            Name
          </span>
          <div class="example-spacer"></div>
          <span>
            <!-- Procurement: <span id="comment">{{procurementCost}}</span> -->
            Procurement: <span>{{procurementCost}}</span>
          </span>
          <div class="example-spacer"></div>
          <span>
            <!-- Total: <span id="comment">{{totalCostSummary}}</span> -->
            Total: <span>{{totalCostSummary}}</span>
          </span>
        </mat-toolbar-row>
      </mat-toolbar>
      <div class="tree-containter">
        <mat-tree [dataSource]="dataSource" [treeControl]="treeControl">
          <mat-tree-node *matTreeNodeDef="let node;" matTreeNodePadding matTreeNodePaddingIndent="10">
            <button color="primary" mat-icon-button disabled></button>
            <div class="checkboxes">
              <span class="mb-4">{{node.name}}</span>
              <mat-checkbox [disabled]="loggedUser.role !== 'fip'" class="mb-2" class="checklist-leaf-node node-title"
                [checked]="node.procurement" (change)="todoLeafItemSelectionToggle(node)">{{'Procurement'}}
              </mat-checkbox>
              <mat-checkbox [disabled]="loggedUser.role !== 'fip'" class="mb-2" class="checklist-leaf-node node-title"
                [checked]="node.rfEntry" (change)="rfEntryToggle(node)">{{'ATTACH RF'}}</mat-checkbox>
            </div>
            <div class="main-container">
              <!-- <div class="quarters">
              <div *ngFor="let month of node.financers; let i =index;">
                <div *ngIf="getDivider(i)" style="font-weight: 500;">
                  Year
                </div>
              </div>
              </div> -->
              <div class="financers">
                <div *ngFor="let month of node.financers;let mI = index;">
                  <div class="months">
                    <div *ngFor="let item of month.financers;let i =index;">
                      <div *ngIf="getMonth(i);" style="font-weight: 500;color:#B00020;">M{{mI + 1}}</div>
                    </div>
                  </div>
                  <div class="inputs">
                    <div *ngFor="let item of month.financers;let i =index;">
                      <mat-form-field>
                        <input [disabled]="loggedUser.role !== 'fip'" (ngModelChange)="costChnaged(node, month)"
                          [placeholder]="item.title" [(ngModel)]="item.cost" matInput type="number" />
                      </mat-form-field>
                      <div *ngIf="(mI+1)%4 === 0" class="spacer"></div>
                    </div>
                  </div>
                </div>
                <span id="answer">{{node.totalCost}}</span>
              </div>
              <!-- <button mat-button>Add RF</button> -->
              <formio *ngIf="node.rfEntry && loggedUser.role === 'fip'" [submission]="{data:getSubmittedData(node)}"
                (submit)="onSubmit($event, node)" [form]="rfForm"></formio>
              <!-- <formio *ngIf="node.rfEntry && loggedUser.role !== 'fip'" [submission]="{data:getSubmittedData(node)}" [renderOptions]="options"
                (submit)="onSubmit($event, node)" [form]="rfForm"></formio> -->
              <formio *ngIf="node.rfEntry && loggedUser.role !== 'fip'" [submission]="{data:getSubmittedData(node)}"
                readOnly="true" (submit)="onSubmit($event, node)" [form]="rfForm"></formio>
            </div>
          </mat-tree-node>

          <mat-tree-node *matTreeNodeDef="let node;when: hasChild" matTreeNodePadding matTreeNodePaddingIndent="10">
            <button color="primary" mat-icon-button matTreeNodeToggle [attr.aria-label]="'toggle ' + node.name">
              <mat-icon class="mat-icon-rtl-mirror">
                {{treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
              </mat-icon>
            </button>
            <div class="parent-title" style="font-weight: 500;">{{node.name}}</div>
            <div class="example-spacer"></div>
            <!-- <span *ngIf="node.procurementCost" style="font-weight: 500;">Procurement:
            <span id="answer">{{node.procurementCost}}</span>
          </span>
          <div class="example-spacer"></div> -->
            <span style="margin-right: 20px;font-weight: 500;">Total:
              <span id="answer">{{node.totalCost}}</span>
            </span>
          </mat-tree-node>

        </mat-tree>
      </div>
    </mat-card-content>
    <mat-card-actions>
      <div class="m-3" style="
        display: flex;
        justify-content: flex-end;
        padding: 15px;">
        <!-- <button [disabled]="selectedProject?.implementationPlan !== null || selectedProject?.status === 'GIA'" *ngIf="!apiLoading" [disabled]="allCosts.length === 0" mat-raised-button color="primary" -->
        <button [disabled]="selectedProject?.status === 'GIA' || allCosts.length === 0" *ngIf="!apiLoading && 
        loggedUser?.role === 'fip'" mat-raised-button color="primary" (click)="saveCostingHeads()">SAVE</button>
        <button *ngIf="!apiLoading && 
        loggedUser?.role === 'admin'" mat-raised-button color="primary" (click)="saveCostingHeads()">SAVE</button>
        <mat-progress-spinner mode="indeterminate" diameter="35" *ngIf="apiLoading"></mat-progress-spinner>
      </div>
    </mat-card-actions>
  </mat-card>
</ng-container>
<!-- <mat-card style="margin: 15px;padding: 5px;">
  <mat-card-content>
    <app-tree 
    [treeData]="testingCosts"></app-tree>
  </mat-card-content>
</mat-card> -->
    <!-- <app-tree 
    (calculateTotal)="calculateTotal($event)" 
    [treeData]="testingCosts"></app-tree> -->
<!-- DUMMY WORK -->
<!-- <mat-card style="margin: 15px;padding: 5px;">
  <mat-card-content>
    <table style="margin-top: 20px;">
      <thead>
        <tr>
          <th style="padding: 10px;">Category Name</th>
          <th style="padding: 10px;" *ngFor="let item of allFinancers">
            {{item.title}}
          </th>
          <th style="padding: 10px;">Total</th>
        </tr>
      </thead>
      <mat-divider></mat-divider>
      <tbody>
        <tr *ngFor="let item of allCosts; let i =index;">
          <td style="padding: 10px;">{{item.title}}</td>
          <td style="padding: 10px;" *ngFor="let object of item?.financers; let j = index;">
            <mat-form-field>
              <input (ngModelChange)="inputChnaged(object._id, item._id)" placeholder="Cost" [(ngModel)]="object.cost"
                matInput type="number" />
            </mat-form-field>
          </td>
          <td style="padding: 10px;">
            {{item?.totalCost}}
          </td>
        </tr>
        <mat-divider></mat-divider>
        <tr>
          <th style="padding: 10px;">Sub Total</th>
          <th style="padding: 10px;" *ngFor="let item of allFinancers; let i =index;">{{item.totalCost}}</th>
          <th style="padding: 10px;">{{totalSummaryCost}}</th>
        </tr>
      </tbody>
    </table>

  </mat-card-content>
</mat-card> -->
<!-- DUMMY TABLE ENDS -->